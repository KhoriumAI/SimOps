# Implementation of Crinkle-Clip (Centroid-Based) Visualization

*Status:* Accepted
*Date:* 2026-01-02
*Tags:* #visualization #geometry #frontend #backend

## 1. Context & Problem Statement
The previous cross-section implementation attempted to calculate "perfect" geometric intersection polygons through the mesh. This approach had two major issues:
1. **Geometric Distortion**: Slicing through tetrahedra created new nodes on the plane, which looked "squashed" when rendered alongside the original mesh and didn't reveal the true internal structure of the underlying elements.
2. **Coordinate Alignment**: The main mesh was being centered/translated for display in the viewer, but the slice data generated by the backend used original coordinates, causing a vertical or lateral "floating" offset between the two.
3. **Control Intuition**: Clipping sliders were using a -50 to 50 range, which was less intuitive than a standard 0-100% traversal.

## 2. Technical Decision
Instead of calculating plane-triangle intersections, we now implement a **Crinkle Clip** (Centroid-Based) strategy:

*   **Mechanism (Backend)**:
    - Identify all volume elements (Tetrahedra/Hexahedra) whose **centroid** lies behind the specified clipping plane.
    - Extract the **boundary faces** (the shell) of this subset of elements.
    - Result: A "jaggy" or "crinkled" surface that exactly follows the faces of the internal tets, providing high-fidelity insight into the meshing quality and element shapes.
*   **Mechanism (Frontend)**:
    - Adjusted `MeshObject` to compute and expose the `renderOffset` used for centering.
    - Passed this offset to the `SliceMesh` component to ensure exact spatial synchronization.
    - Updated clipping sliders to a 0-100 range and synchronized the plane math: `xPos = (max - (percent/100) * size)`.

## 3. Mathematical & Physical Implications
*   **Conservation**: The visualization now uses the actual faces of the mesh elements. No interpolation of node values is required; the raw quality data (SICN, etc.) assigned to the elements is displayed directly.
*   **Stability**: Eliminates the numerical complexity of polygon clipping (handling co-planar edges, degenerate triangles, etc.), making the cross-section generation much more robust for complex or "dirty" meshes.

## 4. Performance Trade-offs
*   **Compute Cost**: Backend calculation is slightly faster as it replaces floating-point intersection math with simple element-wise centroid checks and a face-adjacency scan.
*   **Memory Cost**: No significant change; the volume is parsed similarly to before, but fewer new vertices are generated.

## 5. Verification Plan
*   **Sanity Check**: Verified with a single tetrahedron model that the faces are preserved and correctly colored based on centroid position.
*   **Visual Check**: Confirmed in the UI that the slice model now perfectly overlaps with the main mesh without the previous "floating" artifact.

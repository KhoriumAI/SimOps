{
    "InstanceIds": [
        "i-0bdb1e0eaa658cc7c"
    ],
    "DocumentName": "AWS-RunShellScript",
    "Parameters": {
        "commands": [
            "cat <<EOF > /home/ec2-user/backend/debug_login.py",
            "import sys",
            "import os",
            "sys.path.append('/home/ec2-user/backend')",
            "from backend.api_server import create_app, db",
            "from backend.models import User, TokenBlocklist",
            "",
            "app = create_app()",
            "print('App created')",
            "with app.app_context():",
            "    try:",
            "        print('Querying user mark@khorium.ai...')",
            "        u = User.query.filter_by(email='mark@khorium.ai').first()",
            "        print(f'User found: {u}')",
            "        if u:",
            "            print('User dict:', u.to_dict())",
            "            print('Password hash:', u.password_hash)",
            "    except Exception as e:",
            "        print('ERROR OCCURRED:')",
            "        print(e)",
            "        import traceback",
            "        traceback.print_exc()",
            "EOF",
            "/home/ec2-user/backend/venv/bin/python /home/ec2-user/backend/debug_login.py"
        ]
    }
}